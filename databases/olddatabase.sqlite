--
-- File generated with SQLiteStudio v3.2.1
--
-- Text encoding used: System
--
PRAGMA foreign_keys = off;
BEGIN TRANSACTION;

-- Table: Message
CREATE TABLE Message (
    id      INTEGER           PRIMARY KEY AUTOINCREMENT
                              UNIQUE,
    object  VARCHAR (5, 50)   NOT NULL,
    content VARCHAR (1, 1000) NOT NULL,
    date    DATETIME
);


-- Table: sent_and_recieved
CREATE TABLE sent_and_recieved (
    id_message INTEGER REFERENCES Message (id) ON DELETE NO ACTION
                       UNIQUE
                       NOT NULL,
    sender     VARCHAR UNIQUE
                       REFERENCES User (email)
                       NOT NULL,
    reciever   VARCHAR REFERENCES User (email)
                       NOT NULL
                       UNIQUE
);


-- Table: User
CREATE TABLE User (
    email    VARCHAR (5, 25) PRIMARY KEY
                             UNIQUE
                             NOT NULL,
    password VARCHAR (8, 32) NOT NULL,
    status   BOOLEAN         DEFAULT (true),
    admin    BOOLEAN         DEFAULT (false)
);

INSERT INTO User (
                     email,
                     password,
                     status,
                     admin
                 )
                 VALUES (
                     'walid.massaoudi@heig-vd.ch',
                     '12345678',
                     'true',
                     'true'
                 );

INSERT INTO User (
                     email,
                     password,
                     status,
                     admin
                 )
                 VALUES (
                     'jessy.pinkman@breakingB.us',
                     '12345678',
                     'true',
                     'false'
                 );

INSERT INTO User (
                     email,
                     password,
                     status,
                     admin
                 )
                 VALUES (
                     'walter.white@breakingB.us',
                     '12345678',
                     'true',
                     'false'
                 );

INSERT INTO User (
                     email,
                     password,
                     status,
                     admin
                 )
                 VALUES (
                     'maxime.dupont@heig-vd.ch',
                     '12345678',
                     'true',
                     'true'
                 );

INSERT INTO User (
                     email,
                     password,
                     status,
                     admin
                 )
                 VALUES (
                     'zied.naimi@heig-vd.ch',
                     '12345678',
                     'true',
                     'true'
                 );


-- Trigger: add_msg
CREATE TRIGGER add_msg
         AFTER INSERT
            ON Message
      FOR EACH ROW
BEGIN
    SELECT *;
END;


-- View: Directory
CREATE VIEW Directory AS
    SELECT email AS email_address
      FROM User
     ORDER BY email ASC;


-- View: get_recieved_msg
CREATE VIEW get_recieved_msg AS
    SELECT sender AS Sender
      FROM sent_and_recieved
     WHERE User.email = sent_and_recieved.reciever
     ORDER BY date ASC;


-- View: get_sent_messages
CREATE VIEW get_sent_messages AS
    SELECT reciever AS Destination
      FROM sent_and_recieved
     WHERE User.email = sent_and_recieved.sender
     ORDER BY date ASC;


COMMIT TRANSACTION;
PRAGMA foreign_keys = on;
